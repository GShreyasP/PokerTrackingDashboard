<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- App Icon for Home Screen -->
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <title>Poker Money Tracker</title>
    <link rel="stylesheet" href="/style.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="/firebase-init.js"></script>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <h1>Poker Money Tracker</h1>
            <div class="header-actions-right">
                <button id="install-app-btn" class="btn btn-install" onclick="showInstallInstructions()">Install App</button>
                <button id="friends-btn" class="btn btn-friends hidden" onclick="toggleFriendsSidebar()">
                    Friends
                    <span id="friends-notification-badge" class="notification-badge hidden">0</span>
                </button>
                <div id="header-user-info" class="header-user-info hidden">
                    <div class="header-user-details">
                        <span id="header-user-name"></span>
                        <span id="header-user-id" class="header-user-id"></span>
                    </div>
                    <button id="header-sign-out-btn" class="btn btn-sign-out" onclick="signOut()">Sign Out</button>
                </div>
            </div>
        </div>
        <script>
            // Immediately hide friends button and show install button on page load
            (function() {
                const friendsBtn = document.getElementById('friends-btn');
                if (friendsBtn) {
                    friendsBtn.classList.add('hidden');
                    friendsBtn.style.display = 'none';
                }
                const installAppBtn = document.getElementById('install-app-btn');
                if (installAppBtn) {
                    installAppBtn.classList.remove('hidden');
                    installAppBtn.style.display = '';
                }
            })();
        </script>
        
        <!-- Authentication Section (shown first) -->
        <div id="auth-page" class="auth-page">
            <div class="auth-container">
                <h2>Welcome</h2>
                <p>Sign in or create an account to get started</p>
                
                <div id="auth-tabs" class="auth-tabs">
                    <button class="auth-tab active" onclick="showLoginForm()">Sign In</button>
                    <button class="auth-tab" onclick="showSignupForm()">Create Account</button>
                </div>
                
                <!-- Login Form -->
                <div id="login-form" class="auth-form">
                    <div class="form-group">
                        <label for="login-email">Email:</label>
                        <input type="email" id="login-email" placeholder="Enter your email" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password:</label>
                        <input type="password" id="login-password" placeholder="Enter your password" class="form-input">
                        <a href="#" class="forgot-password-link" onclick="showForgotPasswordForm(); return false;">Forgot password?</a>
                    </div>
                    <button class="btn btn-primary" onclick="loginWithEmail()">Sign In</button>
                    <div id="login-error" class="auth-error hidden"></div>
                </div>
                
                <!-- Forgot Password Form -->
                <div id="forgot-password-form" class="auth-form hidden">
                    <h3>Reset Password</h3>
                    <p style="color: #666; margin-bottom: 20px;">Enter your email address and we'll send you a link to reset your password.</p>
                    <div class="form-group">
                        <label for="reset-email">Email:</label>
                        <input type="email" id="reset-email" placeholder="Enter your email" class="form-input">
                    </div>
                    <button class="btn btn-primary" onclick="sendPasswordReset()">Send Reset Link</button>
                    <button class="btn btn-secondary" onclick="backToLogin()" style="margin-top: 10px; background: #6c757d;">Back to Sign In</button>
                    <div id="reset-error" class="auth-error hidden"></div>
                    <div id="reset-success" class="auth-success hidden"></div>
                </div>
                
                <!-- Signup Form -->
                <div id="signup-form" class="auth-form hidden">
                    <div class="form-group">
                        <label for="signup-email">Email:</label>
                        <input type="email" id="signup-email" placeholder="Enter your email" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password:</label>
                        <input type="password" id="signup-password" placeholder="Create a password (min 6 characters)" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="signup-name">Name (optional):</label>
                        <input type="text" id="signup-name" placeholder="Enter your name" class="form-input">
                    </div>
                    <button class="btn btn-primary" onclick="signupWithEmail()">Create Account</button>
                    <div id="signup-error" class="auth-error hidden"></div>
                </div>
                
                <div class="auth-divider">
                    <span>OR</span>
                </div>
                
                <button class="btn btn-google" onclick="signInWithGoogle()">
                    <svg width="18" height="18" viewBox="0 0 18 18" style="margin-right: 8px;">
                        <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/>
                        <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
                        <path fill="#FBBC05" d="M3.964 10.712c-.18-.54-.282-1.117-.282-1.712s.102-1.172.282-1.712V4.956H.957C.348 6.174 0 7.55 0 9s.348 2.826.957 4.044l3.007-2.332z"/>
                        <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.956L3.964 7.288C4.672 5.163 6.656 3.58 9 3.58z"/>
                    </svg>
                    Continue with Google
                </button>
            </div>
        </div>
        
        <!-- Main Screen (shown when authenticated but no tracker) -->
        <div id="main-screen" class="main-screen hidden">
            <div class="main-screen-content">
                <button id="create-tracker-btn" class="btn btn-primary btn-create-tracker" onclick="showSetupSection()">
                    + Create Your Own Table
                </button>
                <div id="tracker-limit-error" class="tracker-limit-error hidden"></div>
                
                <div class="your-tables-section">
                    <h2>Your Tables</h2>
                    <div id="your-tables-container" class="live-tables-container">
                        <p class="no-live-tables">No tables created yet</p>
                    </div>
                </div>
                
                <div class="live-tables-section">
                    <h2>Live Tables</h2>
                    <div id="live-tables-container" class="live-tables-container">
                        <p class="no-live-tables">No live tables available</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Initial Setup Section (hidden until authenticated) -->
        <div id="setup-section" class="setup-section hidden">
            <h2>Initial Setup</h2>
            
            <div class="form-group">
                <label for="num-people">Number of People:</label>
                <input type="number" id="num-people" min="1" placeholder="0">
            </div>
            
            <div class="form-group">
                <label for="stack-value">How much is 1 stack worth? ($):</label>
                <input type="number" id="stack-value" min="0" step="0.01" placeholder="0">
            </div>
            
            <div class="form-group">
                <label for="chips-per-stack">Chips per Stack:</label>
                <input type="number" id="chips-per-stack" min="1" step="1" placeholder="0">
            </div>
            
            <div class="form-group">
                <label class="toggle-label">
                    <input type="checkbox" id="same-value-toggle">
                    <span>All chips are worth the same</span>
                </label>
            </div>
            
            <div id="different-chips-section">
                <h3>Chip Values</h3>
                <div class="chip-inputs">
                    <div class="form-group">
                        <label for="black-value">Black Chip Value ($):</label>
                        <input type="number" id="black-value" min="0" step="0.01" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="white-value">White Chip Value ($):</label>
                        <input type="number" id="white-value" min="0" step="0.01" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="green-value">Green Chip Value ($):</label>
                        <input type="number" id="green-value" min="0" step="0.01" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="red-value">Red Chip Value ($):</label>
                        <input type="number" id="red-value" min="0" step="0.01" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="blue-value">Blue Chip Value ($):</label>
                        <input type="number" id="blue-value" min="0" step="0.01" placeholder="0">
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">Number of Chips per Stack</h3>
                <div class="chip-inputs">
                    <div class="form-group">
                        <label for="black-count">Number of Black Chips:</label>
                        <input type="number" id="black-count" min="0" step="1" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="white-count">Number of White Chips:</label>
                        <input type="number" id="white-count" min="0" step="1" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="green-count">Number of Green Chips:</label>
                        <input type="number" id="green-count" min="0" step="1" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="red-count">Number of Red Chips:</label>
                        <input type="number" id="red-count" min="0" step="1" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="blue-count">Number of Blue Chips:</label>
                        <input type="number" id="blue-count" min="0" step="1" placeholder="0">
                    </div>
                </div>
            </div>

            <div class="setup-actions">
                <button id="setup-btn" class="btn btn-primary">Start Tracking</button>
            </div>
        </div>
        
        <div class="setup-actions" style="margin-top: 20px;">
            <button id="back-to-main-btn" class="btn btn-secondary hidden" onclick="showMainScreen()">Back to Home</button>
        </div>
        
        <!-- Main Tracking Section -->
        <div id="tracking-section" class="tracking-section hidden">
            <div class="tracking-header">
                <div class="total-pot">
                    <h2>Total Pot: $<span id="total-pot-amount">0.00</span></h2>
                    <div id="chip-value-display" class="chip-value-display"></div>
                </div>
                <div class="header-actions">
                    <div id="user-info" class="user-info">
                        <span id="user-name"></span>
                        <button id="sign-out-btn" class="btn btn-sign-out" onclick="signOut()">Sign Out</button>
                    </div>
                    <button id="settlement-btn" class="btn btn-settlement" onclick="showSettlementModal()">Settlement</button>
                    <button id="add-person-btn" class="btn btn-add-person" onclick="showAddPersonForm()">+ Add Person</button>
                    <button id="reset-btn" class="btn btn-reset" onclick="deleteCurrentTable()">Delete Table</button>
                </div>
            </div>
            
            <div id="chips-warning" class="chips-warning hidden"></div>
            
            <div id="people-widgets" class="people-widgets"></div>
            
            <div class="chip-total-tracker">
                <h3>Total Chips in Play: <span id="total-chips-amount">0</span></h3>
            </div>
            
            <div class="transaction-log">
                <h2>Transaction Log</h2>
                <div id="log-entries" class="log-entries"></div>
            </div>
        </div>
        
        <!-- Settlement Modal -->
        <div id="settlement-modal" class="modal hidden">
            <div class="modal-content">
                <div id="settlement-options" class="settlement-options">
                    <h2>Settlement Options</h2>
                    <button class="btn btn-settle-option" onclick="showHouseSettlement()">House Settle</button>
                    <button class="btn btn-settle-option" onclick="showPlayerToPlayerSettlement()">Player to Player Settlement</button>
                </div>
                
                <div id="house-settlement-view" class="settlement-view hidden">
                    <h2>House Settlement</h2>
                    <div id="house-settlement-results"></div>
                    <button class="btn btn-back" onclick="backToSettlementOptions()">Back</button>
                </div>
                
                <div id="player-settlement-view" class="settlement-view hidden">
                    <h2>Player to Player Settlement</h2>
                    <div id="player-settlement-results"></div>
                    <button class="btn btn-back" onclick="backToSettlementOptions()">Back</button>
                </div>
                
                <button class="btn btn-close-modal" onclick="closeSettlementModal()">Back to Dashboard</button>
            </div>
        </div>
        
        <!-- Friends Sidebar -->
        <div id="friends-sidebar" class="friends-sidebar hidden">
            <div class="friends-sidebar-header">
                <h2>Friends</h2>
                <button class="btn-close-sidebar" onclick="toggleFriendsSidebar()">×</button>
            </div>
            
            <div class="friends-sidebar-content">
                <!-- Add Friend Section -->
                <div class="friends-add-section">
                    <h3>Add Friend</h3>
                    <div class="friends-search">
                        <input type="text" id="friend-search-input" placeholder="Search by username" class="form-input">
                        <button class="btn btn-primary btn-sm" onclick="searchFriend()">Search</button>
                    </div>
                    <div id="friend-search-results" class="friend-search-results hidden"></div>
                    
                    <div class="friends-invite-section">
                        <h4>Or Invite by Link</h4>
                        <div class="invite-link-container">
                            <div class="invite-link-text" id="invite-link-text">https://poker-tracking-dashboard.vercel.app/</div>
                            <button class="btn btn-primary btn-sm" onclick="copyInviteLink()">Copy Link</button>
                        </div>
                        <small>Share this link with friends to invite them</small>
                    </div>
                </div>
                
                <!-- Tracker Join Requests Section -->
                <div id="tracker-join-requests-section" class="friends-section hidden">
                    <h3>Tracker Join Requests</h3>
                    <div id="tracker-join-requests-list" class="friends-list"></div>
                </div>
                
                <!-- Tracker Access Requests Section -->
                <div id="tracker-access-requests-section" class="friends-section hidden">
                    <h3>Tracker Access Requests</h3>
                    <div id="tracker-access-requests-list" class="friends-list"></div>
                </div>
                
                <!-- Friend Requests Section -->
                <div id="friend-requests-section" class="friends-section hidden">
                    <h3>Friend Requests</h3>
                    <div id="friend-requests-list" class="friends-list"></div>
                </div>
                
                <!-- Online Friends Section -->
                <div id="online-friends-section" class="friends-section">
                    <h3>Online Friends</h3>
                    <div id="online-friends-list" class="friends-list">
                        <p class="no-friends">No online friends</p>
                    </div>
                </div>
                
                <!-- Offline Friends Section -->
                <div id="offline-friends-section" class="friends-section">
                    <h3>Offline Friends</h3>
                    <div id="offline-friends-list" class="friends-list">
                        <p class="no-friends">No offline friends</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Overlay for sidebar -->
        <div id="sidebar-overlay" class="sidebar-overlay hidden" onclick="toggleFriendsSidebar()"></div>
        
        <!-- Custom Modal for Amount Input -->
        <!-- Install Instructions Modal -->
        <div id="install-instructions-modal" class="custom-modal hidden" onclick="if(event.target === this) closeInstallInstructions()">
            <div class="custom-modal-content" onclick="event.stopPropagation()">
                <div class="custom-modal-header">
                    <h2>Install App</h2>
                    <button class="modal-close-btn" onclick="closeInstallInstructions()">×</button>
                </div>
                <div class="custom-modal-body">
                    <ol style="text-align: left; padding-left: 20px; line-height: 1.8;">
                        <li>Press Share (found in browser)</li>
                        <li>Scroll down to find "Add to Home"</li>
                        <li>Leave everything as is and press "Add"</li>
                    </ol>
                </div>
                <div class="custom-modal-footer">
                    <button class="btn btn-primary" onclick="closeInstallInstructions()">Got it</button>
                </div>
            </div>
        </div>
        
        <div id="amount-input-modal" class="custom-modal hidden" onclick="if(event.target === this) closeAmountInputModal()">
            <div class="custom-modal-content" onclick="event.stopPropagation()">
                <div class="custom-modal-header">
                    <h3 id="amount-input-title">Enter Amount</h3>
                </div>
                <div class="custom-modal-body">
                    <p id="amount-input-message">Enter the amount of money you want to put in the tracker:</p>
                    <input type="number" id="amount-input-field" class="custom-modal-input" placeholder="0.00" step="0.01" min="0.01">
                </div>
                <div class="custom-modal-footer">
                    <button class="btn btn-secondary" onclick="closeAmountInputModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="confirmAmountInput()">OK</button>
                </div>
            </div>
        </div>
        
        <!-- Custom Modal for Alert/Confirmation -->
        <div id="alert-modal" class="custom-modal hidden" onclick="if(event.target === this) closeAlertModal()">
            <div class="custom-modal-content" onclick="event.stopPropagation()">
                <div class="custom-modal-header">
                    <h3>Notification</h3>
                </div>
                <div class="custom-modal-body">
                    <p id="alert-message"></p>
                </div>
                <div class="custom-modal-footer">
                    <button class="btn btn-primary" onclick="closeAlertModal()">OK</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/script.js"></script>
</body>
</html>

